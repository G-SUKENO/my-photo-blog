---
import Layout from '../layouts/Layout.astro';
// ãƒ‘ã‚¹ãŒé€šã‚‰ãªã„å ´åˆã¯ã€ç›´æ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã§ã¯ãªããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã«åˆã‚ã›ã¾ã™
import { getBlogs } from '../lib/microcms';

// contentã®å‹ã‚’å®šç¾©ã—ã¦ã€Œanyã€ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãã¾ã™
interface BlogContent {
  id: string;
  title: string;
}

const response = await getBlogs({ fields: ["id", "title"] });
---

<Layout title="My Photo Blog">
	<main>
		<h1>My Photo Blog</h1>
		
		<audio id="bgm-player" src="/bgm.mp3" loop></audio>

		<ul class="post-list">
			{
				response.contents.map((content: BlogContent) => (
					<li class="post-item">
						<span class="post-title">{content.title}</span>
						<div class="button-group">
							<a href={`/posts/${content.id}`} class="btn standard">é€šå¸¸è¡¨ç¤º</a>
							<button class="btn with-bgm" data-id={content.id}>ğŸµ BGMä»˜ã</button>
						</div>
					</li>
				))
			}
		</ul>
	</main>
</Layout>

<script>
	const bgm = document.getElementById('bgm-player') as HTMLAudioElement;
	const bgmButtons = document.querySelectorAll('.with-bgm');

	bgmButtons.forEach(button => {
		button.addEventListener('click', () => {
			const postId = button.getAttribute('data-id');
			
			if (bgm) {
				bgm.play().then(() => {
					setTimeout(() => {
						window.location.href = `/posts/${postId}`;
					}, 500);
				}).catch(error => {
					console.error("å†ç”Ÿã‚¨ãƒ©ãƒ¼:", error);
					window.location.href = `/posts/${postId}`;
				});
			}
		});
	});
</script>

<style>
	/* ã‚¹ã‚¿ã‚¤ãƒ«ã¯å…ˆã»ã©ã¨åŒã˜ */
	main {
		margin: auto;
		padding: 1rem;
		width: 800px;
		max-width: calc(100% - 2rem);
		color: #333;
		font-size: 20px;
		line-height: 1.6;
	}
	h1 {
		font-size: 2.5rem;
		font-weight: 700;
		text-align: center;
		margin-bottom: 2em;
	}
	.post-list {
		list-style: none;
		padding: 0;
	}
	.post-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1rem;
		border-bottom: 1px solid #eee;
	}
	.post-title {
		font-weight: bold;
	}
	.button-group {
		display: flex;
		gap: 10px;
	}
	.btn {
		padding: 8px 16px;
		border-radius: 20px;
		text-decoration: none;
		font-size: 14px;
		cursor: pointer;
		transition: 0.3s;
		border: none;
	}
	.standard {
		background-color: #f0f0f0;
		color: #333;
	}
	.with-bgm {
		background-color: #0070f3;
		color: white;
	}
	.btn:hover {
		opacity: 0.8;
		transform: translateY(-2px);
	}
</style>