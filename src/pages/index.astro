---
import Layout from '../layouts/Layout.astro';
import { getBlogs } from '../lib/microcms';

interface BlogContent {
  id: string;
  title: string;
}

let response;
try {
  response = await getBlogs();
} catch (e) {
  console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", e);
  response = { contents: [] };
}
---

<Layout title="My Photo Blog">
	<main>
		<h1>My Photo Blog</h1>
		<audio id="bgm-player" src="/bgm.mp3" loop></audio>

		<ul class="post-list">
			{
				response.contents && response.contents.map((content: BlogContent) => (
					<li class="post-item">
						<span class="post-title">{content.title}</span>
						<div class="button-group">
							<a href={`/posts/${content.id}`} class="btn standard">é€šå¸¸è¡¨ç¤º</a>
							<button class="btn with-bgm" data-id={content.id}>ğŸµ BGMä»˜ã</button>
						</div>
					</li>
				))
			}
		</ul>
	</main>
</Layout>

<script>
	const bgm = document.getElementById('bgm-player') as HTMLAudioElement;
	const bgmButtons = document.querySelectorAll('.with-bgm');

	bgmButtons.forEach(button => {
		button.addEventListener('click', () => {
			const postId = button.getAttribute('data-id');
			if (bgm) {
				bgm.play().then(() => {
					setTimeout(() => {
						window.location.href = `/posts/${postId}`;
					}, 500);
				}).catch(() => {
					window.location.href = `/posts/${postId}`;
				});
			}
		});
	});
</script>

<style>
  /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯ãã®ã¾ã¾ */
	main { margin: auto; padding: 1rem; width: 800px; max-width: calc(100% - 2rem); }
	.post-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #eee; }
	.button-group { display: flex; gap: 10px; }
	.btn { padding: 8px 16px; border-radius: 20px; text-decoration: none; font-size: 14px; cursor: pointer; border: none; }
	.standard { background-color: #f0f0f0; color: #333; }
	.with-bgm { background-color: #0070f3; color: white; }
</style>